{% extends "worker_base.html" %}
{% block content %}

<h2>ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>

<div class="cards">
  <div class="card blue">
    <div class="title">ì˜¤ëŠ˜ ì…ê³ </div>
    <div id="inToday" class="num">0</div>
  </div>
  <div class="card red">
    <div class="title">ì˜¤ëŠ˜ ì¶œê³ </div>
    <div id="outToday" class="num">0</div>
  </div>
</div>

<div class="grid">
  <div class="panel">
    <h3>ğŸ“¦ ì¬ê³  TOP 5</h3>
    <canvas id="topChart"></canvas>
  </div>
  <div class="panel">
    <h3>ğŸ“ˆ ìµœê·¼ 7ì¼ ì…Â·ì¶œê³ </h3>
    <canvas id="weekChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadDashboard(){
  const res = await fetch("/api/dashboard/summary");
  const d = await res.json();

  document.getElementById("inToday").innerText = d.today.in;
  document.getElementById("outToday").innerText = d.today.out;

  // TOP ì¬ê³ 
  new Chart(document.getElementById("topChart"), {
    type: "bar",
    data: {
      labels: d.top_items.map(x=>x.item_code),
      datasets: [{
        label: "ì¬ê³  ìˆ˜ëŸ‰",
        data: d.top_items.map(x=>x.qty),
        backgroundColor: "#2563eb"
      }]
    }
  });

  // ì£¼ê°„ ì…ì¶œê³ 
  new Chart(document.getElementById("weekChart"), {
    type: "line",
    data: {
      labels: d.weekly.map(x=>x.date),
      datasets: [
        {
          label: "ì…ê³ ",
          data: d.weekly.map(x=>x.in),
          borderColor: "#16a34a",
          fill: false
        },
        {
          label: "ì¶œê³ ",
          data: d.weekly.map(x=>x.out),
          borderColor: "#dc2626",
          fill: false
        }
      ]
    }
  });
}

loadDashboard();
</script>

<style>
.cards{display:flex;gap:12px;margin-bottom:16px}
.card{flex:1;padding:16px;border-radius:12px;color:#fff}
.card.blue{background:#2563eb}
.card.red{background:#dc2626}
.card .title{font-size:14px;opacity:.9}
.card .num{font-size:28px;font-weight:900;margin-top:6px}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.panel{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
</style>

{% endblock %}
