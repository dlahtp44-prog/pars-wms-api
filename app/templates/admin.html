{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="row between">
    <div>
      <div class="h1">ğŸ›  ê´€ë¦¬ì</div>
      <div class="muted">ì´ë ¥ ë¡¤ë°±(ì‹¤ìˆ˜ ë³µêµ¬)</div>
    </div>
    <a class="btn" href="/admin/logout">ë¡œê·¸ì•„ì›ƒ</a>
  </div>

  <div class="tablewrap">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>êµ¬ë¶„</th><th>ì°½ê³ </th><th>ë¡œì¼€ì´ì…˜</th><th>í’ˆë²ˆ</th><th>LOT</th><th class="right">ìˆ˜ëŸ‰</th><th>ì‹œê°„</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.tx_type }}</td>
          <td>{{ r.warehouse }}</td>
          <td>{{ r.location }}</td>
          <td>{{ r.item_code }}</td>
          <td>{{ r.lot_no }}</td>
          <td class="right">{{ r.qty }}</td>
          <td>{{ r.created_at }}</td>
          <td>
            <button class="btn danger" onclick="doRollback({{r.id}})">ë¡¤ë°±</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div id="msg" class="muted"></div>
</div>

<script>
async function doRollback(id){
  if(!confirm('ì •ë§ ë¡¤ë°±í• ê¹Œìš”?')) return;
  const res = await fetch('/api/history/rollback/' + id, {method:'POST'});
  const d = await res.json();
  document.getElementById('msg').innerText = res.ok ? 'âœ… ë¡¤ë°± ì™„ë£Œ' : ('âŒ ' + (d.detail || JSON.stringify(d)));
  if(res.ok) location.reload();
}
</script>
{% endblock %}
