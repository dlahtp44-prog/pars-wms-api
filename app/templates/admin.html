{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

  <h2 class="mb-3">ğŸ› ï¸ ê´€ë¦¬ì ì„¼í„°</h2>

  <!-- ğŸ”¹ ê´€ë¦¬ì ë²„íŠ¼ ì˜ì—­ -->
  <div class="row mb-4">
    <div class="col-md-3 mb-2">
      <a href="/dashboard" class="btn btn-dark w-100">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
    </div>
    <div class="col-md-3 mb-2">
      <a href="/labels/product" class="btn btn-secondary w-100">
        ğŸ· ì œí’ˆ QR ë¼ë²¨
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a href="/labels/location" class="btn btn-secondary w-100">
        ğŸ“ ë¡œì¼€ì´ì…˜ QR ë¼ë²¨
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a href="/export/inventory" class="btn btn-outline-primary w-100">
        ğŸ“¦ ì¬ê³  ì—‘ì…€
      </a>
    </div>
    <div class="col-md-3 mb-2">
      <a href="/export/history" class="btn btn-outline-primary w-100">
        ğŸ§¾ ì´ë ¥ ì—‘ì…€
      </a>
    </div>
  </div>

  <hr>

  <!-- ğŸ”¹ ì‘ì—… ë¡œê·¸ / ë¡¤ë°± -->
  <h4 class="mt-4">ğŸ§¾ ì‘ì—… ë¡œê·¸ (ë¡¤ë°± ê´€ë¦¬)</h4>

  <table class="table table-bordered table-hover mt-3">
    <thead class="table-dark">
      <tr>
        <th>ì‹œê°„</th>
        <th>êµ¬ë¶„</th>
        <th>ì°½ê³ </th>
        <th>ë¡œì¼€ì´ì…˜</th>
        <th>í’ˆë²ˆ</th>
        <th>LOT</th>
        <th>ìˆ˜ëŸ‰</th>
        <th>ê¸°ëŠ¥</th>
      </tr>
    </thead>
    <tbody id="logTable"></tbody>
  </table>
</div>

<script>
async function loadLogs() {
  const res = await fetch('/api/admin/logs');
  const logs = await res.json();

  const html = logs.map(log => `
    <tr>
      <td>${log.created_at}</td>
      <td>
        <span class="badge ${
          log.tx_type === 'IN' ? 'bg-primary' :
          log.tx_type === 'OUT' ? 'bg-danger' :
          'bg-warning'
        }">
          ${log.tx_type}
        </span>
      </td>
      <td>${log.warehouse}</td>
      <td>${log.location}</td>
      <td>${log.item_code}</td>
      <td>${log.lot_no}</td>
      <td>${log.qty}</td>
      <td>
        <button class="btn btn-sm btn-warning"
          onclick="rollback(${log.id})">
          ë¡¤ë°±
        </button>
      </td>
    </tr>
  `).join('');

  document.getElementById('logTable').innerHTML = html;
}

async function rollback(id) {
  if(!confirm('ì´ ì‘ì—…ì„ ì·¨ì†Œí•˜ê³  ì¬ê³ ë¥¼ ì›ìƒë³µêµ¬ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

  const res = await fetch(`/api/admin/rollback/${id}`, {
    method: 'POST'
  });

  if(res.ok){
    alert('âœ… ë¡¤ë°± ì™„ë£Œ');
    loadLogs();
  } else {
    alert('âŒ ë¡¤ë°± ì‹¤íŒ¨');
  }
}

loadLogs();
</script>

{% endblock %}
