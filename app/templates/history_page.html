{% extends "base.html" %}
{% block content %}
<div class="card">
    <div class="card-header">
        <h2>ğŸ“œ ìµœê·¼ ì‘ì—… ì´ë ¥</h2>
    </div>
    <div class="table-container">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="border-b border-slate-700 text-slate-400">
                    <th class="p-3">ì¼ì‹œ</th>
                    <th class="p-3">ìœ í˜•</th>
                    <th class="p-3">í’ˆëª©ì½”ë“œ</th>
                    <th class="p-3">ìˆ˜ëŸ‰</th>
                    <th class="p-3">ë¡œì¼€ì´ì…˜</th>
                    <th class="p-3">ë¹„ê³ </th>
                </tr>
            </thead>
            <tbody id="history-list">
                </tbody>
        </table>
    </div>
</div>

<script>
async function loadHistory() {
    try {
        const res = await fetch('/api/history');
        const data = await res.json();
        const list = document.getElementById('history-list');
        list.innerHTML = '';

        data.forEach(h => {
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-800 hover:bg-slate-800/50";
            
            // ìœ í˜•ë³„ ìƒ‰ìƒ ì²˜ë¦¬
            let typeTag = `<span class="px-2 py-1 rounded text-xs font-bold bg-slate-700">${h.tx_type}</span>`;
            if(h.tx_type === 'IN') typeTag = `<span class="px-2 py-1 rounded text-xs font-bold bg-green-900 text-green-300">ì…ê³ </span>`;
            if(h.tx_type === 'OUT') typeTag = `<span class="px-2 py-1 rounded text-xs font-bold bg-red-900 text-red-300">ì¶œê³ </span>`;
            if(h.tx_type === 'MOVE') typeTag = `<span class="px-2 py-1 rounded text-xs font-bold bg-blue-900 text-blue-300">ì´ë™</span>`;

            // ë¡œì¼€ì´ì…˜ í‘œì‹œ (ì´ë™ì¸ ê²½ìš° From -> To)
            let locInfo = h.location || '-';
            if(h.tx_type === 'MOVE' && h.to_location) {
                locInfo = `${h.from_location || h.location} â” ${h.to_location}`;
            }

            tr.innerHTML = `
                <td class="p-3 text-slate-400 text-sm">${h.created_at.replace('T', ' ').substring(0, 16)}</td>
                <td class="p-3">${typeTag}</td>
                <td class="p-3 font-mono">${h.item_code}</td>
                <td class="p-3 ${h.qty < 0 ? 'text-red-400' : 'text-green-400'}">${h.qty}</td>
                <td class="p-3 text-sm">${locInfo}</td>
                <td class="p-3 text-slate-500 text-xs">${h.remark || ''}</td>
            `;
            list.appendChild(tr);
        });
    } catch (e) {
        console.error("ì´ë ¥ ë¡œë“œ ì‹¤íŒ¨:", e);
    }
}
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', loadHistory);
</script>
{% endblock %}
