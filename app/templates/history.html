{% extends "base.html" %}
{% block content %}

<h4 class="fw-bold mb-3">이력 조회</h4>

<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>시간</th>
            <th>TYPE</th>
            <th>창고</th>
            <th>LOC</th>
            <th>ITEM</th>
            <th>LOT</th>
            <th>QTY</th>
            <th>비고</th>
            <th>ROLLBACK</th>
        </tr>
    </thead>
    <tbody id="histBody"></tbody>
</table>

<script>
async function loadHist(){
    const res = await fetch("/api/history");
    const rows = await res.json();

    let html = "";
    for(const r of rows){
        html += `
        <tr>
            <td>${r.id}</td>
            <td>${r.tx_time}</td>
            <td>${r.tx_type}</td>
            <td>${r.warehouse}</td>
            <td>${r.location}</td>
            <td>${r.item_code}</td>
            <td>${r.lot_no}</td>
            <td>${r.qty}</td>
            <td>${r.remark ?? ""}</td>
            <td>
                <button onclick="rollback(${r.id})"
                        class="btn btn-sm btn-danger">
                    취소
                </button>
            </td>
        </tr>`;
    }
    document.getElementById("histBody").innerHTML = html;
}

async function rollback(id){
    if(!confirm("해당 이력을 롤백할까요?")) return;

    await fetch(`/api/history/rollback?tx_id=${id}`, {
        method: "POST"
    });

    alert("롤백 완료");
    loadHist();
}

loadHist();
</script>

{% endblock %}


