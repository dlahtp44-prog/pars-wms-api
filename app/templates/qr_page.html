{% extends "worker_base.html" %}
{% block content %}

<h3>ğŸ“· QR ìŠ¤ìº”</h3>

<div id="qr-reader" style="width:100%"></div>
<div id="result" style="margin-top:12px;font-weight:bold;"></div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const resultBox = document.getElementById("result");

function onScanSuccess(decodedText) {
  resultBox.innerText = "ì²˜ë¦¬ ì¤‘...";

  fetch("/api/qr", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ qr: decodedText })
  })
  .then(res => res.json())
  .then(d => {
    if(d.ok){
      resultBox.innerText = "âœ… ì²˜ë¦¬ ì™„ë£Œ";
    } else {
      resultBox.innerText = "âŒ ì˜¤ë¥˜: " + d.msg;
      resultBox.style.color = "red";
    }
  })
  .catch(err => {
    resultBox.innerText = "âŒ ì„œë²„ ì˜¤ë¥˜";
    resultBox.style.color = "red";
  });
}

const html5QrCode = new Html5Qrcode("qr-reader");

html5QrCode.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
</script>

{% endblock %}
