<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì…ê³  ì²˜ë¦¬</title>
<style>
body { font-family: sans-serif; padding: 16px; }
select, input, button {
  width: 100%; margin: 8px 0; padding: 10px; font-size: 16px;
}
button { background:#2ecc71; color:white; border:none; }
</style>
</head>
<body>
{% extends "base.html" %}
{% block content %}

<h2>ğŸ“¥ ì…ê³  ì²˜ë¦¬</h2>

<h3>â‘  ìˆ˜ê¸° ì…ë ¥</h3>
<form action="/api/inbound/manual" method="post">
  <input name="item_code" placeholder="í’ˆë²ˆ" required>
  <input name="item_name" placeholder="ì œí’ˆëª…" required>
  <input name="spec" placeholder="ì‚¬ì´ì¦ˆ/ê·œê²©" required>
  <input name="lot_no" placeholder="LOT" required>
  <input name="location_name" placeholder="ì°½ê³ ëª…" required>
  <input name="location" placeholder="ë¡œì¼€ì´ì…˜" required>
  <input name="qty" type="number" placeholder="ìˆ˜ëŸ‰" required>
  <button type="submit">ì…ê³  ì²˜ë¦¬</button>
</form>

<hr>

<h3>â‘¡ ì—‘ì…€(CSV) ì—…ë¡œë“œ</h3>
<form action="/api/inbound/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="file" accept=".csv" required>
  <button type="submit">CSV ì…ê³  ì—…ë¡œë“œ</button>
</form>

<p style="color:gray;">
CSV ì»¬ëŸ¼ ìˆœì„œ:<br>
item_code,item_name,spec,lot_no,location_name,location,qty
</p>

{% endblock %}

<h2>ğŸ“¦ ì…ê³  ì²˜ë¦¬</h2>

<input id="item" placeholder="í’ˆëª©ì½”ë“œ" />
<input id="qty" type="number" placeholder="ìˆ˜ëŸ‰" />

<select id="warehouse"></select>
<select id="zone"></select>
<select id="rack"></select>
<select id="cell"></select>

<button onclick="submitInbound()">ì…ê³  ì²˜ë¦¬</button>

<script>
let data = {};

fetch("/locations")
  .then(res => res.json())
  .then(json => {
    data = json;
    const wh = document.getElementById("warehouse");
    wh.innerHTML = `<option value="">ì°½ê³  ì„ íƒ</option>`;
    Object.keys(data).forEach(w =>
      wh.innerHTML += `<option value="${w}">${w}</option>`
    );
  });

warehouse.onchange = () => {
  zone.innerHTML = "";
  rack.innerHTML = "";
  cell.innerHTML = "";

  Object.keys(data[warehouse.value]).forEach(z =>
    zone.innerHTML += `<option value="${z}">${z}</option>`
  );
};

zone.onchange = () => {
  rack.innerHTML = "";
  cell.innerHTML = "";

  Object.keys(data[warehouse.value][zone.value]).forEach(r =>
    rack.innerHTML += `<option value="${r}">${r}</option>`
  );
};

rack.onchange = () => {
  cell.innerHTML = "";
  data[warehouse.value][zone.value][rack.value]
    .forEach(c =>
      cell.innerHTML += `<option value="${c}">${c}</option>`
    );
};

function submitInbound() {
  const url = `/inbound?item=${item.value}&qty=${qty.value}` +
              `&warehouse=${warehouse.value}` +
              `&zone=${zone.value}` +
              `&rack=${rack.value}` +
              `&level=01&cell=${cell.value}`;

  fetch(url, { method: "POST" })
    .then(r => r.json())
    .then(r => alert(JSON.stringify(r)));
}
</script>

</body>
</html>
