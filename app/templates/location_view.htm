{% extends "worker_base.html" %}
{% block worker_content %}

<h2>ğŸ“ ë¡œì¼€ì´ì…˜ ì¬ê³  ì¡°íšŒ</h2>

<div class="card">
  <div id="reader" style="width:100%; max-width:360px;"></div>
  <button class="btn" onclick="startScan()">ğŸ“· ë¡œì¼€ì´ì…˜ QR ìŠ¤ìº”</button>
  <div id="msg" class="muted"></div>
</div>

<div id="result" class="card" style="display:none;">
  <h3 id="locTitle"></h3>
  <table class="table">
    <thead>
      <tr>
        <th>í’ˆë²ˆ</th>
        <th>í’ˆëª…</th>
        <th>ê·œê²©</th>
        <th>LOT</th>
        <th class="right">ìˆ˜ëŸ‰</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="/static/qr_camera.js"></script>

<script>
async function processQR(text){
  const p = new URLSearchParams(text);
  const warehouse = p.get("warehouse") || "MAIN";
  const location = p.get("location");

  if(!location){
    document.getElementById("msg").innerText = "âŒ ë¡œì¼€ì´ì…˜ QRì´ ì•„ë‹™ë‹ˆë‹¤";
    return;
  }

  const res = await fetch(
    `/api/qr/location?warehouse=${warehouse}&location=${location}`
  );
  const data = await res.json();

  document.getElementById("locTitle").innerText =
    `ğŸ“ ${data.location} ì¬ê³ `;

  const tb = document.getElementById("tbody");
  tb.innerHTML = "";

  if(data.items.length === 0){
    tb.innerHTML =
      "<tr><td colspan='5'>ì¬ê³  ì—†ìŒ</td></tr>";
  } else {
    data.items.forEach(r=>{
      tb.innerHTML += `
        <tr>
          <td>${r.item_code}</td>
          <td>${r.item_name}</td>
          <td>${r.spec}</td>
          <td>${r.lot_no}</td>
          <td class="right">${r.qty}</td>
        </tr>
      `;
    });
  }

  document.getElementById("result").style.display = "block";
}
</script>

{% endblock %}
