{% extends "worker_base.html" %}
{% block content %}
<h2>QR 스캔</h2>
<video id="preview" width="100%"></video>
<script src="/static/qr.js"></script>


<h3>QR 스캔</h3>

<input
  id="qr"
  placeholder="QR 스캔"
  autofocus
  onkeydown="if(event.key==='Enter'){ scan(); }"
/>

<button onclick="scan()">자동 처리</button>

<div id="result" style="margin-top:15px;"></div>

<script>
async function scan() {
  const qr = document.getElementById("qr").value;

  const res = await fetch("/api/qr/process", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ qr_data: qr })
  });

  const data = await res.json();

  document.getElementById("result").innerHTML =
    "✅ 처리 완료 : " + data.action;

  // 0.7초 후 작업자 메인 복귀
  setTimeout(() => location.href = "/worker", 700);
}
</script>

{% endblock %}
